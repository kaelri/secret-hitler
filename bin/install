#!/usr/bin/env node

var dotenv = require('dotenv').config();
var mysql  = require('mysql');

var connection = mysql.createConnection({
  host     : process.env.DB_HOST,
  user     : process.env.DB_USER,
  password : process.env.DB_PASS,
  database : process.env.DB_NAME
});
 
connection.connect();

let sql;

// USERS
sql = `CREATE TABLE \`users\` (
	\`id\` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT,
	\`name\` varchar(60) NOT NULL DEFAULT '',
	\`hash\` varchar(255) NOT NULL DEFAULT '',
	\`salt\` varchar(255) NOT NULL DEFAULT '',
	\`display\` varchar(100) NOT NULL DEFAULT '',
	\`email\` varchar(100) NOT NULL DEFAULT '',
	\`roles\` varchar(100) NOT NULL DEFAULT '',
	\`created\` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (id)
);`

connection.query(sql, function (error, results, fields) {
  if (error) throw error;
});

// GAMES
sql = `CREATE TABLE \`games\` (
	\`id\` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT,
	\`code\` varchar(60) NOT NULL DEFAULT '',
	\`name\` varchar(60) NOT NULL DEFAULT '',
	\`status\` varchar(60) NOT NULL DEFAULT '',
	\`content\` longtext NOT NULL DEFAULT '',
	\`owner\` bigint(20) UNSIGNED NOT NULL,
	\`created\` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
	\`modified\` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (id)
);`

connection.query(sql, function (error, results, fields) {
  if (error) throw error;
});

// PLAYERS
sql = `CREATE TABLE \`players\` (
	\`id\` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT,
	\`game_id\` bigint(20) UNSIGNED NOT NULL,
	\`user_id\` bigint(20) UNSIGNED NOT NULL,
	\`created\` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
	\`modified\` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (id)
);`

connection.query(sql, function (error, results, fields) {
  if (error) throw error;
});

// Finish.
console.log(`“${process.env.DB_NAME}” database installed!`);
 
connection.end();
